Question 1
==========

Your goal in this project is to break RSA when the public modulus _N_ is generated incorrectly. This should serve as yet another reminder not to implement crypto primitives yourself.

Normally, the primes that comprise an RSA modulus are generated independently of one another. But suppose a developer decides to generate the first prime _p_ by choosing a random number _R_ and scanning for a prime close by. The second prime _q_ is generated by scanning for some other random prime also close to R. We show that the resulting RSA modulus _N = pq_ can be easily factored.

Suppose you are given a composite N and are told that _N_ is a product of two relatively close primes _p_ and _q_, namely _p_ and _q_ satisfy

![|pâˆ’q|<2N^1/4](http://latex.codecogs.com/png.latex?|p-q|<2N^{1/4}%5Ctext{&space;%28*%29})

Your goal is to factor _N_.

Let _A_ be the arithmetic average of the two primes, that is ![A=(p+q)/2](http://latex.codecogs.com/png.latex?A=%5Ctfrac{p&plus;q}{2}). Since _p_ and _q_ are odd, we know that ![p+q](http://latex.codecogs.com/png.latex?p&plus;q) is even and therefore _A_ is an integer.

To factor _N_ you first observe that under condition (*) the quantity ![N^1/2](http://latex.codecogs.com/png.latex?%5Csqrt{N}) is very close to _A_. In particular

![A-N^1/2<1](http://latex.codecogs.com/png.latex?{A}-%5Csqrt{N}<1)

as shown below. But since _A_ is an integer, rounding ![N^1/2](http://latex.codecogs.com/png.latex?%5Csqrt{N}) up to the closest integer reveals the value of _A_. In code, `A = ceil(sqrt(N))` where `ceil` is the ceiling function. Visually, the numbers _p_, _q_, ![N^1/2](http://latex.codecogs.com/png.latex?%5Csqrt{N}) and _A_ are ordered as follows:

![numbers](https://d396qusza40orc.cloudfront.net/crypto/images%2Fproj6-fig.jpg)

Since _A_ is the exact mid-point between _p_ and _q_ there is an integer _x_ such that ![p=A-x](http://latex.codecogs.com/png.latex?{p}={A}-x) and ![q=A+x](http://latex.codecogs.com/png.latex?{q}={A}&plus;x). But then

![N=pq=(A-x)(A+x)=A^2-x^2 and therefore x=(A^2-N)^1/2](http://latex.codecogs.com/png.latex?N%3Dpq%3D%28A-x%29%28A&plus;x%29%3D%7BA%7D%5E%7B2%7D-%7Bx%7D%5E%7B2%7D%5Ctext%7B%20and%20therefore%20%7Dx%3D%5Csqrt%7B%7BA%7D%5E%7B2%7D-N%7D)

Now, given _x_ and _A_ you can find the factors _p_ and _q_ of _N_ since ![p=A-x](http://latex.codecogs.com/png.latex?{p}={A}-x) and ![q=A+x](http://latex.codecogs.com/png.latex?{q}={A}&plus;x).

In the following challenges, you will factor the given moduli using the method outlined above. To solve this assignment it is best to use an environment that supports multi-precision arithmetic and square roots. In Python you could use the __gmpy2__ module. In C you can use __GMP__.

### Factoring challenge #1

The following modulus _N_ is a products of two primes _p_ and _q_ where ![|p-q|<2N^1/4](http://latex.codecogs.com/png.latex?|p-q|<2N^{1/4}). Find the smaller of the two factors and enter it as a decimal integer.

```
N = 17976931348623159077293051907890247336179769789423065727343008115 \
    77326758055056206869853794492129829595855013875371640157101398586 \
    47833778606925583497541085196591615128057575940752635007475935288 \
    71082364994994077189561705436114947486504671101510156394068052754 \
    0071584560878577663743040086340742855278549092581
```

### Factoring challenge #2

The following modulus _N_ is a products of two primes _p_ and _q_ where ![|p-q|<2^11*N^1/4](http://latex.codecogs.com/png.latex?|p-q|<2^{11}N^{1/4}). Find the smaller of the two factors and enter it as a decimal integer.

_Hint:_ in this case ![A-N^1/2<2^20](http://latex.codecogs.com/png.latex?{p}={A}-%5Csqrt{N}<2^{20}) so try scanning for _A_ from ![N^1/2](http://latex.codecogs.com/png.latex?%5Csqrt{N}) upwards, until you succeed in factoring _N_.

```
N = 6484558428080716696628242653467722787263437207069762630604390703787 \
    9730861808111646271401527606141756919558732184025452065542490671989 \
    2428844841839353281972988531310511738648965962582821502504990264452 \
    1008852816733037111422964210278402893076574586452336833570778346897 \
    15838646088239640236866252211790085787877
```

### Factoring challenge #3 _(extra credit)_

The following modulus _N_ is a products of two primes _p_ and _q_ where ![|3p-2q|<N^1/4](http://latex.codecogs.com/png.latex?|3p-2q|<N^{1/4}). Find the smaller of the two factors and enter it as a decimal integer.

_Hint_: use the calculation below to show that ![6N^1/2](http://latex.codecogs.com/png.latex?%5Csqrt{6N}) is close to ![3p+2q/2](http://latex.codecogs.com/png.latex?%5Ctfrac{3p+2q}{2}) and then adapt the method above to factor _N_.

```
N = 72006226374735042527956443552558373833808445147399984182665305798191 \
    63556901883377904234086641876639384851752649940178970835240791356868 \
    77441155132015188279331812309091996246361896836573643119174094961348 \
    52463970788523879939683923036467667022162701835329944324119217381272 \
    9276147530748597302192751375739387929
```

The only remaining mystery is why ![A-N^1/2<1](http://latex.codecogs.com/png.latex?{A}-%5Csqrt{N}<1). This follows from the following simple calculation. First observe that

![magic](http://latex.codecogs.com/png.latex?%7BA%7D%5E%7B2%7D-N%3D%5Cleft%28%5Cfrac%7Bp&plus;q%7D%7B2%7D%5Cright%29%5E%7B2%7D-N%3D%5Cfrac%7Bp%5E2&plus;2N&plus;q%5E2%7D%7B4%7D-N%3D%5Cfrac%7Bp%5E2-2N&plus;q%5E2%7D%7B4%7D%3D%28p-q%29%5E%7B2%7D/4)

Now, since for all ![science](http://latex.codecogs.com/png.latex?x%2Cy%3A%28x-y%29%28x&plus;y%29%3Dx%5E%7B2%7D-y%5E%7B2%7D) we obtain

![magic](http://latex.codecogs.com/png.latex?A-%5Csqrt%7BN%7D%3D%28A-%5Csqrt%7BN%7D%29%5Ctimes%5Cfrac%7BA&plus;%5Csqrt%7BN%7D%7D%7BA&plus;%5Csqrt%7BN%7D%7D%3D%5Cfrac%7BA%5E%7B2%7D-N%7D%7BA&plus;%5Csqrt%7BN%7D%7D%3D%5Cfrac%7B%28p-q%29%5E%7B2%7D/4%7D%7BA&plus;%5Csqrt%7BN%7D%7D)

and since ![N^1/2=<A](http://latex.codecogs.com/png.latex?%5Csqrt{N}%5Cleq{A}) it follows that

![magic](http://latex.codecogs.com/png.latex?A-%5Csqrt%7BN%7D%5Cleq%5Cfrac%7B%28p-q%29%5E%7B2%7D/4%7D%7B2%5Csqrt%7BN%7D%7D%3D%5Cfrac%7B%28p-q%29%5E2%7D%7B8%5Csqrt%7BN%7D%7D)

By assumption (*) we know that ![science](http://latex.codecogs.com/png.latex?%28p-q%29%5E2%3C4%5Csqrt%7BN%7D) and therefore

![magic](http://latex.codecogs.com/png.latex?A-%5Csqrt%7BN%7D%5Cleq%5Cfrac%7B4%5Csqrt%7BN%7D%7D%7B8%5Csqrt%7BN%7D%7D%3D%5Cfrac%7B1%7D%7B2%7D)

as required.

 _Further reading_: the method described above is a greatly simplified version of a much more general [result](http://dl.acm.org/citation.cfm?id=1754517) on factoring when the high order bits of the prime factor are known.
